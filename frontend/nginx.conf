# This is the Nginx config file.
# It tells Nginx to serve the static React files and proxy API requests.

# --- FIX APPLIED ---
# The 'events {}' and 'http {}' blocks have been removed.
# The Nginx image loads this file *inside* an existing 'http' block,
# so we must only provide the 'server' block.

server {
  listen 80;
  server_name localhost;

  # 1. Serve static files (the built React app)
  location / {
    root   /usr/share/nginx/html;
    index  index.html index.htm;
    # This line is crucial for single-page-applications (SPAs) like React
    try_files $uri $uri/ /index.html; 
  }

  # 2. Proxy Text-to-SQL API requests
  location /api/text-to-sql/ {
    # The 'text_to_sql_service' name comes from docker-compose.yml
    proxy_pass http://text_to_sql_service:8000/; 
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # 3. Proxy Diagnostics API requests
  location /api/diagnostics/ {
    # The 'diagnostics_service' name comes from docker-compose.yml
    proxy_pass http://diagnostics_service:8001/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # Error and access logs
  error_log  /var/log/nginx/error.log;
  access_log /var/log/nginx/access.log;
}

